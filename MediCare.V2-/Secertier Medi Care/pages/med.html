<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#10b981',
                        accent: '#009688',
                        background: '#FFFFFF',
                        text: '#333333',
                        alert: '#E53935',
                    },
                    fontFamily: {
                        heading: ['Montserrat', 'sans-serif'],
                        body: ['"Source Sans 3"', 'sans-serif'],
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <script>
        if (localStorage.getItem("theme") === "dark") {
            document.documentElement.classList.add("dark");
        }


        tailwind.config = { darkMode: 'class' }

        function toggleDarkMode() {
            document.documentElement.classList.toggle("dark");

            if (document.documentElement.classList.contains("dark")) {
                localStorage.setItem("theme", "dark");
            } else {
                localStorage.setItem("theme", "light");
            }
        }


        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

    </script>

    <title>MediCare +</title>
</head>

<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <div class="flex h-screen">
        <!-- Sidebar -->

        <button onclick="toggleSidebar()"
            class="md:hidden text-gray-500 dark:text-gray-400 mr-4 ml-4 top-0 mt-2 right-0 fixed z-30">
            <i class="fas fa-bars text-xl"></i>
        </button>


        <div id="sidebar"
            class="w-64 bg-white dark:bg-gray-800 shadow-lg transform transition-transform duration-300 md:translate-x-0 -translate-x-full fixed md:relative z-20 h-full">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h1 class="text-xl font-bold text-blue-600 dark:text-blue-400">Dashboard Admin</h1>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Espace Secrétaire</p>
            </div>

            <nav class="mt-6">
                <div class="px-6 py-3 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <a href="index.html"
                        class="flex items-center text-gray-700 dark:text-gray-300">
                        <i class="fas fa-tachometer-alt w-5 mr-3"></i>
                        <span>Tableau de bord</span>
                    </a>
                </div>

                <div class="px-6 py-3 bg-blue-50 dark:bg-gray-700 border-r-4 border-blue-500">
                    <a href="" class="flex items-center text-blue-600 dark:text-blue-400">
                        <i class="fas fa-user-md w-5 mr-3"></i>
                        <span>Médecins</span>
                    </a>
                </div>

                <div class="px-6 py-3 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <a href="specialiti.html" class="flex items-center text-gray-700 dark:text-gray-300">
                        <i class="fas fa-calendar-alt w-5 mr-3"></i>
                        <span>Spécialités</span>
                    </a>
                </div>

                <div class="px-6 py-3 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <a href="desponabilite.html" class="flex items-center text-gray-700 dark:text-gray-300">
                        <i class="fas fa-users w-5 mr-3"></i>
                        <span>Disponibilités</span>
                    </a>
                </div>

                <div class="px-6 py-3 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <a href="appointemt.html" class="flex items-center text-gray-700 dark:text-gray-300">
                        <i class="fas fa-file-medical w-5 mr-3"></i>
                        <span>Rendez-vous</span>
                    </a>
                </div>

            </nav>

            <div class="absolute bottom-0 w-full p-6 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-gray-700 dark:text-gray-300">Mode Sombre</span>
                    <button onclick="toggleDarkMode()"
                        class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 dark:bg-gray-600 transition-colors">
                        <span
                            class="inline-block h-4 w-4 transform bg-white rounded-full transition-transform translate-x-1 dark:translate-x-6"></span>
                    </button>
                </div>

                <button id="desconectBtn"
                    class="flex items-center text-red-500 w-full py-2 px-4 rounded-lg hover:bg-red-50 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-sign-out-alt w-5 mr-3"></i><span>Déconnexion</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-col w-full px-6 md:px-12 p-6 gap-8 relative">
            <!-- Page Content -->
            <div class="">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-8">
                        <h1
                            class="text-2xl font-heading font-bold text-gray-800 dark:text-white mb-2 text-center md:text-start">
                            Gestion des Médecins</h1>
                        <p class="text-gray-600 font-body dark:text-gray-400 text-center md:text-start">Gérez vos
                            médecins et rendez-vous en toute
                            simplicité
                        </p>
                    </div>

                    <button id="ajoute" class="mb-4 lg:mb-0">
                        <p class="font-body bg-blue-600 text-white px-2 py-1 rounded-lg">+ ajouter un medcin</p>
                    </button>
                </div>
                <!-- <div id="search"
                    class="flex justify-center items-center w-[70vw] md:w-[500px] h-8 bg-slate-200 dark:bg-gray-700 rounded-lg font-body text-slate-600 px-3 ">
                    <i class="fa-solid fa-magnifying-glass fa-sm  pr-3" style="color: #9d9d9d;"></i>
                    <input id="search" type="text" placeholder="Rechercher un médecin..."
                        class="bg-transparent outline-none w-full placeholder-slate-400">
                </div> -->
            </div>

            <!---Form ajoute-->
            <div id="form"
                class="flex flex-col items-center gap-3 w-[90vw] md:w-[500px] bg-white dark:bg-[#0f172a] border border-gray-300 dark:border-[#334155] rounded-lg absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 hidden">
                <div class="flex w-[90%] mt-4">
                    <h1 class="text-text dark:text-white font-heading font-medium pl-1">Ajouter un médecin</h1>
                </div>
                <div class="flex flex-col w-[90%]">
                    <label class="text-text dark:text-white font-body pl-1">Nom complet *</label>
                    <input id="Nom" type="text"
                        class="w-full rounded-md bg-gray-100 dark:bg-[#334155]/30 border border-transparent dark:border-[#334155] placeholder:font-body h-8 pl-2 text-text dark:text-white text-sm"
                        placeholder="Dr. Ayoub elfaqir">
                </div>
                <div class="flex flex-col w-[90%] cursor-pointer relative">
                    <label class="text-text dark:text-white font-body pl-1">Spécialité *</label>
                    <select id="user-choise"
                        class="flex items-center justify-between w-full rounded-md bg-gray-100 dark:bg-[#334155]/30 border border-transparent dark:border-[#334155] placeholder:font-body h-8 pl-2 text-text dark:text-white text-md">

                    </select>
                </div>
                <!---image URL-->
                <div class="flex flex-col w-[90%]">
                    <label class="text-text dark:text-white font-body pl-1">URL de la photo</label>
                    <input id="url" type="text"
                        class="w-full rounded-md bg-gray-100 dark:bg-[#334155]/30 border border-transparent dark:border-[#334155] placeholder:font-body h-8 pl-2 text-text dark:text-white text-sm"
                        placeholder="https://example.com/photo.jpg">
                </div>
                <!---Description-->
                <div class="flex flex-col w-[90%]">
                    <label class="text-text dark:text-white font-body pl-1">Description</label>
                    <textarea id="description" type="text"
                        class="w-full rounded-md bg-gray-100 dark:bg-[#334155]/30 border border-transparent dark:border-[#334155] placeholder:font-body h-16 pl-2 text-text dark:text-white text-sm"
                        placeholder="Spécialiste en cardiologie avec 15 ans d'éxpérience..."></textarea>
                </div>
                <!---Ajouter Annuler--->
                <div class="flex flex-col lg:flex-row-reverse lg:justify-start gap-2 w-[90%] mb-4 mt-2">
                    <button id="ajouterform">
                        <p id="ajoutform-text"
                            class="lg:w-24 w-56 font-body bg-blue-700 text-white px-2 py-1 rounded-lg ">ajouter</p>
                    </button>
                    <button id="annuler"
                        class="flex justify-center bg-gray-500 dark:bg-[#334155]/30 border border-transparent dark:border-[#334155] rounded-lg lg:w-28 w-56 items-center py-1 gap-4">
                        <p class="text-white">Annuler</p>
                    </button>

                </div>
            </div>

            <!-----Doctors cards----->
            <div id="doctors-cards-container" class="flex justify-center flex-wrap gap-8">
                <!-- <div class="flex flex-col justify-center items-center gap-2 w-72 bg-white dark:bg-gray-800 shadow-lg px-6 py-5 rounded-xl  ">
                    <div class="grid grid-cols-[auto_auto] gap-10">

                        <img src="/hospital-healthcare-workers-covid-19-treatment-concept-young-doctor-scrubs-making-daily-errands-clinic-listening-patient-symptoms-look-camera-professional-physician-curing-diseases(1).jpg"
                            class="w-16 h-16 rounded-full border-gray-500" alt="">

                        <div class="grid grid-rows-[auto_auto_auto]">
                            <h2 class="dark:text-white text-black font-semibold font-heading">Name doctor</h2>
                            <p class="dark:text-gray-400 text-text font-body ">spécialité</p>
                            <div class="flex gap-2 items-center ">
                                <div class="w-2 h-2 rounded-full bg-red-600"></div>
                                <p class="dark:text-gray-400 text-text font-body">disponabilité</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center w-full h-[72px] break-words dark:text-gray-400 text-text">
                        <p class="text-sm line-clamp-3">Lorem ipsum dolor sit amet consectetur elit, Dolorem in eaque.
                        </p>
                    </div>
                    <div class="flex gap-4 w-[85%]">
                        <button
                            class="flex justify-center bg-gray-700 hover:dark:bg-gray-600 rounded-lg w-full items-center gap-4"><i
                                class="fa-solid fa-pen-to-square" style="color: #ffffff;"></i>
                            <p class="text-white">Modify</p>
                        </button>
                        <button class="bg-red-600 px-2 py-1 rounded-lg"><i class="fa-solid fa-trash"
                                style="color: #ffffff;"></i></button>
                    </div>
                </div> -->
            </div>
            <div id="succes-mes"
                class="max-w-xs sm:max-w-sm mx-auto mt-5 p-4 rounded-lg shadow-lg bg-green-100 dark:bg-green-900 
            border border-green-400 dark:border-green-700 text-green-700 dark:text-green-200 text-center absolute top-[80%] left-[50%] -translate-x-1/2 hidden">
                <p class="mt-1 text-sm sm:text-base">Médecin ajouté avec succès.</p>
            </div>

        </div>



        <script>
            const ajouterDoctor = document.getElementById('ajoute');
            const input = document.getElementById('input');
            const form = document.getElementById('form');
            const ajoutForm = document.getElementById('ajouterform');
            const ajoutForm_text = document.getElementById('ajoutform-text')
            const annulerForm = document.getElementById('annuler');
            const alldoctors = document.getElementById('doctors-cards-container');
            const specialite_list = document.getElementById('choises');

            const nomInput = document.getElementById('Nom');
            const specialiteInput = document.getElementById('user-choise');
            const urlInput = document.getElementById('url');
            const descriptionInput = document.getElementById('description');
            const succes_message = document.getElementById('succes-mes');
            const general_date = new Date();
            let today = general_date.getDay();
            let currentCard = null;

            let doctors = JSON.parse(localStorage.getItem('doctors info')) || [];
            let all_specialites = JSON.parse(localStorage.getItem('specialites')) || [];

            let formStatus = false;

            console.log(today)

            switch (today) {
                case 1:
                    today = 'Lundi'
                    break;
                case 2:
                    today = 'Mardi'
                    break;
                case 3:
                    today = 'Mercredi'
                    break;
                case 4:
                    today = "Jeudi"
                    break;
                case 5:
                    today = 'Vendredi'
                    break;
                case 6:
                    today = 'Samedi'
                    break;
                case 0:
                    today = 'Dimanche'
                    break;


            }

            if (doctors) {
                doctors.forEach(doctor => {
                    createnewcard(doctor, today);
                });

            }

            if (all_specialites) {
                specialitesAdd();
            }

            console.log(today);
            function specialitesAdd() {
                const specialite_choix = document.createElement('option');
                specialite_choix.classList = " w-full h-auto pl-2 dark:text-text bg-gray-100 dark:bg-[#334155]";
                specialite_choix.textContent = "choisir un medicin";
                specialiteInput.value = "";
                specialiteInput.appendChild(specialite_choix);//////////////////////////
                all_specialites.forEach(one => {
                    const specialite_choix = document.createElement('option');
                    specialite_choix.classList = " w-full h-auto pl-2 dark:text-text bg-gray-100 dark:bg-[#334155]";
                    specialite_choix.textContent = one;
                    specialite_choix.value = one;
                    specialiteInput.appendChild(specialite_choix);


                })
            }



            function resetForm() {
                //vider le form 
                ajoutForm_text.textContent = "ajouter";
                nomInput.value = "";
                descriptionInput.value = "";
                urlInput.value = "";
                specialiteInput.selectedIndex = 0;
                formStatus = false;
            }

            function createnewcard(doctor, today) {
                // card div
                const card = document.createElement('div');
                card.className = "flex flex-col justify-start items-center gap-2 w-72 h-[232px] bg-white dark:bg-gray-800 shadow-lg px-6 py-5 rounded-xl";
                card.dataset.id = doctor.id
                alldoctors.appendChild(card);
                // image , name ,specialite , disponabilitée container .
                const upperContainer = document.createElement('div');
                upperContainer.className = "grid grid-cols-[auto_auto] h-[72px] gap-10";
                card.appendChild(upperContainer);
                // img of doctor 
                const doctorImg = document.createElement('img');
                doctorImg.src = doctor.url;
                doctorImg.className = "w-16 h-16 rounded-full border-gray-500";
                upperContainer.appendChild(doctorImg)
                //name , spécialité , disponabilitée div
                const doctorInfo = document.createElement('div');
                doctorInfo.className = "grid grid-rows-[auto_auto_auto]";
                upperContainer.appendChild(doctorInfo);
                //name
                const name = document.createElement('h2');
                name.className = "dark:text-white text-black font-semibold font-heading";
                name.textContent = doctor.nom;
                doctorInfo.appendChild(name);
                //spécialité
                const doctorSpec = document.createElement('p');
                doctorSpec.className = "optn dark:text-gray-400 text-text font-body";
                doctorSpec.textContent = doctor.specialite;

                doctorInfo.appendChild(doctorSpec);
                //disponabilité
                const doctordispo = document.createElement('div')
                doctordispo.className = "flex gap-2 items-center";
                doctorInfo.appendChild(doctordispo);
                //cercle avec rouge for indisponible and vert for disponible
                const cercle_red_green = document.createElement('div');
                if (doctor.days.includes(today)) {
                    cercle_red_green.className = "w-2 h-2 rounded-full bg-green-600";
                } else {
                    cercle_red_green.className = "w-2 h-2 rounded-full bg-red-600";
                }
                doctordispo.appendChild(cercle_red_green);
                //disponible ou indisponible text
                const disponible = document.createElement('p');
                disponible.className = "dark:text-gray-400 text-text font-body";
                console.log(doctor.days);
                console.log(today);
                console.log(doctor.days.includes(today))
                if (doctor.days.includes(today)) {
                    disponible.textContent = "disponible";
                } else {
                    disponible.textContent = "indisponible";
                }
                doctordispo.appendChild(disponible);
                //descrirption container
                const descriptionCon = document.createElement('div');
                descriptionCon.className = "flex items-center w-full h-[72px] break-words dark:text-gray-400 text-text";
                card.appendChild(descriptionCon);
                //description text
                const text = document.createElement('p');
                text.className = "text-sm line-clamp-3"
                text.textContent = doctor.description;
                descriptionCon.appendChild(text);
                //modify delete buttons container
                const buttonsCon = document.createElement('div');
                buttonsCon.className = "flex gap-4 w-[85%]";
                card.appendChild(buttonsCon);
                //modify button
                const modify = document.createElement('button');
                modify.className = "flex justify-center bg-gray-400 hover:bg-gray-600 dark:bg-gray-700 hover:dark:bg-gray-600 rounded-lg w-full items-center gap-4"
                buttonsCon.appendChild(modify);


                //modify function calling
                modify.addEventListener('click', () => {
                    //afficher form avec les informations de medicins
                    nomInput.value = name.textContent;
                    descriptionInput.value = text.textContent;
                    urlInput.value = doctorImg.src;
                    ajoutForm_text.textContent = "modifier";
                    form.classList.remove('hidden');
                    //quand cliquez sur modifier
                    formStatus = true;
                    currentCard = card;
                    console.log('modify mod');
                })
                //inside button icon and text
                const modifyIcon = document.createElement('i');
                const modifyText = document.createElement('p');
                modifyIcon.className = "fa-solid fa-pen-to-square";
                modifyIcon.style = "color: #ffffff;";
                modify.appendChild(modifyIcon);
                modifyText.className = "text-white";
                modifyText.textContent = "Modify"
                modify.appendChild(modifyText);
                //delete button 
                const card_remove = document.createElement('button');
                card_remove.className = "bg-red-600 px-2 py-1 rounded-lg"
                buttonsCon.appendChild(card_remove);
                card_remove.addEventListener('click', () => {
                    card.remove();
                    removefromarray(card);
                })
                //inside delete button icon
                const removeIcon = document.createElement('i');
                removeIcon.className = "fa-solid fa-trash";
                removeIcon.style = "color: #ffffff;";
                card_remove.appendChild(removeIcon);
                //. //ajouter doctor objet in array of all doctors


                form.classList.add('hidden');
                succes_message.classList.remove('hidden')
                setTimeout(() => {
                    succes_message.classList.add('hidden')
                }, 2500)
            }


            //when clicked in modify in form
            function modification_apply(currentCard, nomInput, urlInput, descriptionInput) {
                const doctorObj = doctors.find(doc => doc.id === Number(currentCard.dataset.id));
                //prendre neauveux modification
                doctorObj.nom = nomInput.value;
                doctorObj.url = urlInput.value;
                doctorObj.description = descriptionInput.value;
                doctorObj.specialite = specialiteInput.value;
                console.log(specialiteInput.value);
                // console.log(doctorObj);
                currentCard.querySelector('h2').textContent = nomInput.value; // update name
                currentCard.querySelector('p.text-sm').textContent = descriptionInput.value; // update description
                currentCard.querySelector('img').src = urlInput.value; // update image
                currentCard.querySelector('.optn').textContent = specialiteInput.value;


                localStorage.setItem('doctors info', JSON.stringify(doctors));
            }


            ajouterDoctor.addEventListener('click', () => {
                resetForm();
                form.classList.remove('hidden');
            })

            annulerForm.addEventListener('click', () => {
                if (formStatus === true) {
                    form.classList.add('hidden');
                    resetForm();
                }
                form.classList.add('hidden');
            })



            ajoutForm.addEventListener('click', () => {
                console.log('entering cheking inputs');

                if (nomInput.value == "" || specialiteInput.value == "" || urlInput.value == "" || descriptionInput.value == "") {
                    alert('entrez tous les informations');
                    return;
                }
                console.log('checking modification mod');
                if (formStatus) {
                    console.log('in')
                    modification_apply(currentCard, nomInput, urlInput, descriptionInput);
                    form.classList.add('hidden');
                    formStatus = false;
                    //vider le form 
                    resetForm();
                    return;
                }
                console.log('entering create new');
                //.//ajouter doctor objet in array of all doctors
                const doctor = {
                    id: Date.now(),
                    nom: nomInput.value,
                    specialite: specialiteInput.value,
                    description: descriptionInput.value,
                    url: urlInput.value,
                    days: []
                };

                doctors.push(doctor);
                localStorage.setItem('doctors info', JSON.stringify(doctors));
                console.log('entering function')
                createnewcard(doctor, today);
            })

            function removefromarray(card) {
                const cardindex = doctors.findIndex(doc => doc.id === Number(card.dataset.id));
                if (cardindex === -1) return;          // nothing to remove
                doctors.splice(cardindex, 1);           // remove the item
                localStorage.setItem('doctors info', JSON.stringify(doctors));
            }
            console.log(doctors)


        </script>



        <!-- Mobile sidebar overlay -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-10 md:hidden hidden" onclick="toggleSidebar()">
        </div>

        <script>

            document.getElementById("desconectBtn").addEventListener("click", () => {
                window.location.href = "login.html";
            });

            // Vérif session
            if (sessionStorage.getItem("isLoggedIn") !== "true") {
                window.location.href = "login.html";
            }

            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('-translate-x-full');
                overlay.classList.toggle('hidden');
            }
        </script>
</body>

</html>